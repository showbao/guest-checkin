<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>來賓簽到</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; height: 100vh; display: flex; align-items: center; justify-content: center; font-family: 'Noto Sans TC', sans-serif; }
    .card-box { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); padding: 30px; width: 90%; max-width: 400px; text-align: center; }
    @media (min-width: 768px) { .card-box { max-width: 600px; } h2 { white-space: nowrap; } }
    input { background: #f0f2f5; border: none; border-radius: 10px; padding: 15px; width: 100%; margin-bottom: 15px; font-size: 16px; box-sizing: border-box; }
    .btn-go { background: #000; color: white; padding: 15px; width: 100%; border-radius: 10px; font-size: 18px; font-weight: bold; border: none; cursor: pointer; }
    .btn-go:disabled { background: #999; }
    #overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); display:none; flex-direction:column; align-items:center; justify-content:center; }
    .icon { font-size: 60px; margin-bottom: 10px; }
    .event-title { color: #666; font-size: 1.1rem; margin-bottom: 20px; font-weight: normal; min-height: 24px;}
  </style>
</head>
<body>
<div class="card-box">
  <div class="mb-3"><img src="https://em-content.zobj.net/source/microsoft-teams/337/waving-hand_1f44b.png" width="50"></div>
  <h2 class="mb-2">歡迎蒞臨</h2>
  <div id="event-name" class="event-title">載入中...</div>
  <form id="form">
    <input type="text" id="title" placeholder="職稱 (如：董事長)" required>
    <input type="text" id="name" placeholder="姓名" required>
    <button type="submit" id="btn" class="btn-go">簽到</button>
  </form>
</div>
<div id="overlay"><div class="icon">✅</div><h3>簽到成功</h3><p>即將返回...</p></div>

<script>
  // ⚠️⚠️⚠️ 這裡換成你的 GAS 網址 ⚠️⚠️⚠️
  const API_URL = "https://script.google.com/macros/s/AKfycbw62YC7Q03CC-YL_UyBKR4JXfP_cU3OIiswA9LlHhKLIS1LJrCg2DBT441eaE880C05BA/exec";

  // 1. 初始化：抓取活動名稱
  fetch(API_URL + "?action=getSettings")
    .then(res => res.json())
    .then(data => {
      document.getElementById('event-name').innerText = data.eventName;
    });

  // 2. 簽到邏輯
  document.getElementById('form').addEventListener('submit', function(e) {
    e.preventDefault();
    var btn = document.getElementById('btn');
    var title = document.getElementById('title').value;
    var name = document.getElementById('name').value;
    btn.textContent = "傳送中..."; btn.disabled = true;

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action: "checkin", title: title, name: name })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById('overlay').style.display = 'flex';
      setTimeout(() => window.location.reload(), 2000); 
    })
    .catch(err => { alert("連線錯誤"); btn.disabled = false; btn.textContent = "簽到"; });
  });
</script>
</body>
</html>
